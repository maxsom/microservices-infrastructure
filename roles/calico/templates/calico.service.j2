[Unit]
Description=calico
After=docker.service etcd.service
Requires=docker.service etcd.service

[Service]
Type=forking
RemainAfterExit=yes
Restart=on-failure
RestartSec=20
TimeoutStartSec=20m

ExecStartPre=-/usr/bin/docker kill calico-node
ExecStartPre=-/usr/bin/docker rm calico-node
Environment="ETCD_AUTHORITY={{ calico_etcdaddr }}"
ExecStart=/usr/bin/calicoctl node --ip={{ ansible_default_ipv4.address }} \
                                  --node-image={{ calico_image }}:{{ calico_image_tag }}

ExecStop=/usr/bin/calicoctl node stop

[Install]
WantedBy=multi-user.target
