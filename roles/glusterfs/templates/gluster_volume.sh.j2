#!/usr/bin/env bash
set -ex
NAME=$1

if ! gluster volume list | grep -q $NAME; then
    gluster volume create $NAME \
            replica {{ glusterfs_replication }} \
            {% for server in groups[glusterfs_server_group] %}{{ server }}.node.{{ consul_dns_domain }}:{{ glusterfs_server_data_location }}/$NAME {% endfor %} \
            force # TODO: separate partitions so we don't have to do this
else
    echo "volume already created"
fi
